## awk瑞士军刀片

说起瑞士军刀，可能很多人都听腻了。 有说 Emacs 是瑞士军刀的， 有说 Vim 也是瑞士军刀， 有说 Python 是瑞士军刀的。但是让我们暂时抛开对瑞士军刀的兴趣, 来拨弄一下一页小小的瑞士军刀片-- awk。这个小家伙是一门小巧玲珑的特殊的编程语言。
 
不可我， 总结了一个最好的认识新事物的方法: 迎面冲上去。
看下面这个数据 gfs.data : 
 
```
Li 65 177 10000
Wang 77 180 8000
Niu 60 199  20000
Chen 64.5 168 5000
Ouyang 80 200 12000
Liu 72.5 182 9999
```

- 这个小数据里面包含几个字段， 人名，体重，身高, 月收入的数据。 比如美女需要从这里挑选男朋友标准，怎么选出这里面身高 177 以上的高富帅呢？ 

```
➜  tmp awk ' $3 > 177 { print $1,$3}' gfs.data 
Wang 180
Niu 199
Ouyang 200
Liu 182
```

- tmp 是临时目录，这个是 zsh 里面的一个短路径，略过。 awk 程序的结构是 *pattern { action }* 的结构。
它会默认将字段看作非空白字符组成的序列。（所以你看那些中间的安安静静的空格，被当成是空气了。）剩下的，第一个字段姓名，就是 $1, 第二个体重是 $2, 177， 180, 199, 168, 200,182这些身高值就是 $3了, 依次类推下去。 整个一行是 $0。每个人的颜值，身家是可能不一样的。

- 单引号包起来的 *$3 > 177* 是对每行扫描匹配的条件。当扫到Wang 时， 很明显这家伙180超出预期值，是符合条件的真名天子，被挑出来了。按照这个模式一直搜到最后行， Liu 这个哥儿们也中彩了。
如果这位美女眼光比较高，她找男朋友的条件比较多，比如，收入要高，体重要匀称，智商要高。。。。。。， 这样的话，最好是将她的条件给写到一个文件里面去， conditions.data。一次给她选中得意郎君。

```
awk -f conditions.data gfs.data
```

- *-f* 表示从文件中提取程序，这个标准可以给多个姑娘参考, 选, 不中？不要， 中？ 要得！ 选.....选.....海选!

```
awk -f progfile optionnal list of files
```

- 那么选择的条件一多了， 不想一条条记了，怎么预订一个？ 用到字段的数量 *NF* 了。 *NF* 是 *Awk* 计算当前行的字段数量并存储的内建的变量。

```
➜  tmp awk  '{ print NF, $1, $NF }' gfs.data 
4 Li 10000
4 Wang 8000
4 Niu 20000
4 Chen 5000
4 Ouyang 12000
4 Liu 9999
```
这就打出每一个 boy 的 考察的条件数量，姓名，月收入了。

- 打印真名天子所在的行号 *NR*, 也是一个内建变量，是计算到目前为止，读取到的行的数量, 这里就是相亲的次数（假设这妹子每次相亲都换人）。

```
➜  tmp awk '{print NR, $0}'  gfs.data
1 Li 65 177 10000
2 Wang 77 180 8000
3 Niu 60 199  20000
4 Chen 64.5 168 5000
5 Ouyang 80 200 12000
6 Liu 72.5 182 9999

```

- 表白么？ 

```
➜  tmp awk '$4 > 10000 {print "很有钱的人:", $1, " 月收入:", $4 }' gfs.data  
很有钱的人: Niu  月收入: 20000
很有钱的人: Ouyang  月收入: 12000
```


## 刀片出鞘
一枝军刀片，千军万马削一遍。

